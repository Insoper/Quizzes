<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <title>Peserta - Kuis Interaktif</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <style>
    * {
      box-sizing: border-box;
    }
    body {
      font-family: Arial, sans-serif;
      max-width: 700px;
      margin: 30px auto;
      padding: 20px;
    }
    h2 {
      text-align: center;
      color: #007bff;
    }
    .soal-box {
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 15px;
      margin-top: 20px;
    }
    .pilihan {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-top: 10px;
    }
    .pilihan label {
      background: #e0f0ff;
      padding: 12px;
      border-radius: 6px;
      display: flex;
      justify-content: center;
      align-items: center;
      font-weight: bold;
      cursor: pointer;
    }
    .pilihan input[type="radio"] {
      display: none;
    }
    .pilihan input[type="radio"]:checked + span {
      background-color: #007bff;
      color: white;
      border-radius: 6px;
      padding: 12px;
      display: inline-block;
      width: 100%;
    }
    button {
      padding: 10px 15px;
      margin-top: 15px;
      background-color: #007bff;
      color: white;
      border: none;
      border-radius: 6px;
      font-size: 16px;
      cursor: pointer;
      margin-right: 10px;
    }
    button:hover {
      background-color: #0056b3;
    }
    #loginForm {
      background: #ffffff;
      border: 1px solid #ccc;
      border-radius: 10px;
      padding: 30px 20px;
      max-width: 500px;
      margin: 60px auto;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      text-align: center;
    }
    #loginForm input {
      width: 100%;
      padding: 12px;
      font-size: 16px;
      margin-top: 12px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    #tinjauBox {
      margin-top: 20px;
      text-align: center;
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 10px;
    }
    .tombol-nomor {
      width: 45px;
      height: 45px;
      font-weight: bold;
      border-radius: 8px;
      cursor: pointer;
      line-height: 45px;
      border: none;
      font-size: 16px;
      transition: 0.2s;
    }
    .terisi {
      background: #28a745;
      color: white;
    }
    .kosong {
      background: #ccc;
      color: black;
    }
    #submitBox {
      text-align: center;
      margin-top: 20px;
      display: none;
    }
  </style>

  <!-- Tambahan untuk PWA -->
  <link rel="manifest" href="manifest-siswa.json" />
  <meta name="theme-color" content="#007bff" />
  <link rel="icon" href="icon-192.png" />
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js').then(reg => {
          console.log('Service Worker registered', reg);
        }).catch(err => {
          console.error('Service Worker registration failed:', err);
        });
      });
    }
  </script>
</head>

<body>
  <h2>üìù Kuis Interaktif</h2>
  <div id="loginForm">
    <h3>Login Peserta</h3>
    <input type="text" id="namaPeserta" placeholder="Nama Lengkap Anda" />
    <input type="text" id="kodeKelas" placeholder="Kode Kelas (contoh: 001)" maxlength="3" />
    <button onclick="mulaiKuis()">Mulai Kuis</button>
    <p id="infoStatus" style="color: gray; margin-top:10px;"></p>
  </div>

  <div id="kategoriText" style="text-align:center; font-style:italic; margin-top:10px;"></div>

  <div id="soalArea" class="soal-box" style="display:none;">
    <p id="pertanyaanText"></p>
    <div class="pilihan">
      <label><input type="radio" name="jawaban" value="A" /><span id="labelA"></span></label>
      <label><input type="radio" name="jawaban" value="B" /><span id="labelB"></span></label>
      <label><input type="radio" name="jawaban" value="C" /><span id="labelC"></span></label>
      <label><input type="radio" name="jawaban" value="D" /><span id="labelD"></span></label>
    </div>
    <button onclick="kirimJawaban()">Berikutnya</button>
  </div>

  <div id="tinjauBox"></div>

  <div id="submitBox">
    <p>‚úÖ Semua soal telah dijawab. Silakan tinjau ulang atau submit jawaban Anda.</p>
    <button onclick="tampilkanTinjauan()">üîÅ Tinjau Jawaban</button>
    <button onclick="selesaiKuis()">üöÄ Submit Jawaban</button>
  </div>

  <script>
    let soalList = [], kategori = "", indexSoal = 0;
    let nama = "", kelas = "";
    const JAWABAN_TERKUMPUL = [];

    function mulaiKuis() {
      nama = document.getElementById("namaPeserta").value.trim();
      kelas = document.getElementById("kodeKelas").value.trim();
      if (!nama || !/^\d{3}$/.test(kelas)) {
        document.getElementById("infoStatus").innerText = "Masukkan nama dan kode kelas 3 digit.";
        return;
      }
      const key = "soal_aktif_list_" + kelas;
      const soalData = JSON.parse(localStorage.getItem(key));
      if (!soalData || soalData.length === 0) {
        document.getElementById("infoStatus").innerText = "Soal aktif tidak ditemukan.";
        return;
      }
      kategori = soalData[0].kategori;
      soalList = soalData[0].soal;
      document.getElementById("loginForm").style.display = "none";
      document.getElementById("kategoriText").innerText = `Kategori: ${kategori}`;
      document.getElementById("soalArea").style.display = "block";
      tampilkanSoal();
    }

    function tampilkanSoal() {
      const soal = soalList[indexSoal];
      document.getElementById("pertanyaanText").innerText = soal.Pertanyaan;
      document.getElementById("labelA").innerText = soal.PilihanA;
      document.getElementById("labelB").innerText = soal.PilihanB;
      document.getElementById("labelC").innerText = soal.PilihanC;
      document.getElementById("labelD").innerText = soal.PilihanD;
      document.querySelectorAll('input[name="jawaban"]').forEach(e => e.checked = false);
      if (JAWABAN_TERKUMPUL[indexSoal]) {
        const prev = JAWABAN_TERKUMPUL[indexSoal].Jawaban;
        document.querySelector(`input[name='jawaban'][value='${prev}']`).checked = true;
      }
    }

    function kirimJawaban() {
      const pilihan = document.querySelector('input[name="jawaban"]:checked');
      if (!pilihan) return alert("Silakan pilih jawaban terlebih dahulu.");
      const jawaban = pilihan.value;
      const soal = soalList[indexSoal];
      JAWABAN_TERKUMPUL[indexSoal] = {
        Soal: soal.Pertanyaan,
        Jawaban: jawaban
      };
      indexSoal++;
      if (indexSoal < soalList.length) {
        tampilkanSoal();
      } else {
        document.getElementById("soalArea").style.display = "none";
        cekSemuaTerjawab();
      }
    }

    function cekSemuaTerjawab() {
      if (JAWABAN_TERKUMPUL.length === soalList.length && !JAWABAN_TERKUMPUL.includes(undefined)) {
        document.getElementById("submitBox").style.display = "block";
      }
    }

    function tampilkanTinjauan() {
      const box = document.getElementById("tinjauBox");
      box.innerHTML = "";
      box.style.display = "flex";
      for (let i = 0; i < soalList.length; i++) {
        const btn = document.createElement("button");
        btn.innerText = i + 1;
        btn.className = "tombol-nomor " + (JAWABAN_TERKUMPUL[i] ? "terisi" : "kosong");
        btn.onclick = () => {
          indexSoal = i;
          document.getElementById("submitBox").style.display = "none";
          box.style.display = "none";
          document.getElementById("soalArea").style.display = "block";
          tampilkanSoal();
        };
        box.appendChild(btn);
      }
    }

    function selesaiKuis() {
      let skorBenar = 0;
      JAWABAN_TERKUMPUL.forEach((j, i) => {
        const kunci = soalList[i].KunciJawaban?.trim().toUpperCase();
        if (j.Jawaban === kunci) skorBenar++;
      });
      const skor = Math.round((skorBenar / soalList.length) * 100);

     fetch("https://script.google.com/macros/s/AKfycbwG9fKOzzfYedzx47Wl_E83bKkS0uqPFa_O36Cj-EbRzLn-3WnxTCbCODGxopAAxarFWA/exec", {
  method: "POST",
  mode: "no-cors",
  headers: { "Content-Type": "application/json" },
  body: JSON.stringify({
    Nama: nama,
    Kelas: kelas,
    Kategori: kategori,
    Jawaban: JAWABAN_TERKUMPUL.map(j => j.Jawaban).join(","),
    Skor: skor
  })
})
.then(() => alert("Jawaban berhasil disubmit. Terima kasih!"))
.catch((err) => alert("‚ùå Gagal mengirim jawaban: " + err));
    }
  </script>
</body>
</html>
